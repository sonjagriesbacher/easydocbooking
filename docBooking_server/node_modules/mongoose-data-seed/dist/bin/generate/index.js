'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

exports.default = function (argv) {
  (0, _utils.mustContainUserConfig)();

  var _getOptions = (0, _options.getOptions)(argv),
      seederName = _getOptions.seederName,
      helpWanted = _getOptions.helpWanted;

  if (helpWanted) {
    console.log(_usageGuide2.default);
  } else {
    if (typeof seederName !== 'string' || _lodash2.default.trim(seederName).length < 3) {
      console.log(_chalk2.default.red('ERROR') + ' Please choose a seeder name');
      console.log();
      console.log(_usageGuide2.default);

      throw new Error('exit');
    }

    generateSeeder(seederName);
  }
};

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _memFs = require('mem-fs');

var _memFs2 = _interopRequireDefault(_memFs);

var _memFsEditor = require('mem-fs-editor');

var _memFsEditor2 = _interopRequireDefault(_memFsEditor);

var _chalk = require('chalk');

var _chalk2 = _interopRequireDefault(_chalk);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _config = require('../../lib/config');

var _config2 = _interopRequireDefault(_config);

var _utils = require('../../lib/utils');

var _options = require('./options');

var _usageGuide = require('./usage-guide');

var _usageGuide2 = _interopRequireDefault(_usageGuide);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function generateSeeder(name) {
  var useEs6Generator = _config2.default.useEs6Generator,
      userSeedersFolderName = _config2.default.userSeedersFolderName,
      userSeedersFolderPath = _config2.default.userSeedersFolderPath;


  var seederName = _lodash2.default.upperFirst(_lodash2.default.camelCase(name));
  var seederFileName = _lodash2.default.kebabCase(name) + '.seeder.js';
  var seederFilePath = _path2.default.join(userSeedersFolderPath, seederFileName);
  var seederFileRelativePath = _path2.default.join(userSeedersFolderName, seederFileName);
  var templatePath = useEs6Generator ? _path2.default.join(__dirname, '../../../templates/seeder.es6.js') : _path2.default.join(__dirname, '../../../templates/seeder.js');

  var store = _memFs2.default.create();
  var fs = _memFsEditor2.default.create(store);

  if (fs.exists(seederFilePath)) {
    console.log(_chalk2.default.red('ERROR') + ' ' + seederFileRelativePath + ' are already exists');
    throw new Error('exit');
  }

  fs.copyTpl(templatePath, seederFilePath, { seederName: seederName });

  fs.commit(function () {
    console.log(_chalk2.default.green('CREATED') + ' ' + seederFileRelativePath);
  });
}